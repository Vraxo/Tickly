<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
         xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
         xmlns:vm="clr-namespace:Tickly.ViewModels"
         xmlns:plotting="clr-namespace:Tickly.Views.Plotting"
         x:Class="Tickly.Views.StatisticsPage"
         x:DataType="vm:StatisticsViewModel"
         Title="Daily Progress Statistics">
    <!-- BackgroundColor removed to inherit from style -->

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <Label Text="Progress Over Time"
               FontSize="Large"
               FontAttributes="Bold"
               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
               HorizontalOptions="Center" />

            <Picker Title="Select Time Range"
                ItemsSource="{Binding PlotTimeRanges}"
                SelectedItem="{Binding SelectedPlotTimeRange}"
                TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
                TitleColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray300}}"
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}" />

            <GraphicsView x:Name="ProgressChartView"
                      Drawable="{Binding ChartDrawable}"
                      HeightRequest="250"
                      WidthRequest="350"
                      HorizontalOptions="FillAndExpand"
                      BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}" />
            <!-- Kept Gray950 for chart contrast -->

            <BoxView HeightRequest="1" BackgroundColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}" Margin="0,15,0,15"/>

            <Label Text="Export Daily Progress"
               FontSize="Large"
               FontAttributes="Bold"
               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
               HorizontalOptions="Start" Margin="0,0,0,10"/>

            <Label Text="Export your daily task completion percentages to a .txt file."
               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource LightGray}}"
               FontSize="Small"
               LineBreakMode="WordWrap"
               Margin="0,0,0,10"/>

            <Label Text="Sort Order:"
               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
               FontSize="Small" Margin="0,5,0,0"/>
            <Picker ItemsSource="{Binding ExportSortOrders}"
                SelectedItem="{Binding SelectedExportSortOrder}"
                Title="Select Sort Order"
                TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
                TitleColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray300}}"
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}" />

            <Label Text="Calendar For Dates:"
               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
               FontSize="Small" Margin="0,10,0,0"/>
            <Picker ItemsSource="{Binding ExportCalendarTypes}"
                SelectedItem="{Binding SelectedExportCalendarType}"
                Title="Select Calendar Type"
                TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource WhiteSmoke}}"
                TitleColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray300}}"
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}" />

            <Button Text="Export Progress Data"
                Command="{Binding ExportProgressCommand}"
                BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}"
                Margin="0,15,0,0"
                HorizontalOptions="Start"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
